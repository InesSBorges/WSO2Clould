<?xml version="1.0" encoding="UTF-8"?>
<sequence name="seq_tableDesc" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <property name="messageType" scope="axis2" type="STRING" value="application/xml"/>
    <filter regex="POST" source="$ctx:method" xmlns:ns="http://org.apache.synapse/xsd">
        <then>
            <xslt key="trans_postTableDescIn">
                <property expression="$ctx:validUserLanguage" name="validUserLanguage"/>
                <property expression="$ctx:operationUser" name="operationUser"/>
            </xslt>
            <enrich>
                <source clone="true" type="body"/>
                <target property="inputTableDesc" type="property"/>
            </enrich>
            <sequence key="seq_languageDesc"/>
            <filter regex="true" source="$ctx:validIdLanguageDesc >= 1">
                <then/>
                <else>
                    <propertyGroup>
                        <property expression="//*[local-name() = 'validResultCode']" name="validResultCode" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'validMessage']" name="validMessage" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'validStatus']" name="validStatus" scope="default" type="STRING"/>
                    </propertyGroup>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
            <payloadFactory media-type="xml">
                <format>
                    <result>$1</result>
                </format>
                <args>
                    <arg evaluator="xml" expression="$ctx:inputTableDesc"/>
                </args>
            </payloadFactory>
            <payloadFactory media-type="xml">
                <format>
                    <dat:postTableDesc xmlns:dat="http://ws.wso2.org/dataservice">
                        <dat:Operation>$1</dat:Operation>
                        <dat:IdLanguageDesc>$2</dat:IdLanguageDesc>
                        <dat:IdLanguage>$3</dat:IdLanguage>
                        <dat:OperationUser>$4</dat:OperationUser>
                        <dat:Active>$5</dat:Active>
                    </dat:postTableDesc>
                </format>
                <args>
                    <arg value="INSERT"/>
                    <arg evaluator="xml" expression="$ctx:validIdLanguageDesc"/>
                    <arg evaluator="xml" expression="$ctx:validIdLanguage"/>
                    <arg evaluator="xml" expression="//*[local-name() = 'operationUser']"/>
                    <arg evaluator="xml" expression="//*[local-name() = 'active']"/>
                </args>
            </payloadFactory>
            <call blocking="true">
                <endpoint>
                    <http format="soap12" method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                        <suspendOnFailure>
                            <initialDuration>-1</initialDuration>
                            <progressionFactor>1</progressionFactor>
                        </suspendOnFailure>
                        <markForSuspension>
                            <retriesBeforeSuspension>0</retriesBeforeSuspension>
                        </markForSuspension>
                    </http>
                </endpoint>
            </call>
            <filter regex="true" source="count(//*[local-name() = 'result']) = 1">
                <then>
                    <property expression="//*[local-name() = 'idOutput']" name="validIdTableDesc" scope="default" type="INTEGER"/>
                </then>
                <else>
                    <propertyGroup>
                        <property expression="//*[local-name() = 'resutCode']" name="validResultCode" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'message']" name="validMessage" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'status']" name="validStatus" scope="default" type="STRING"/>
                        <property name="rollbackLanguageDesc" scope="default" type="STRING" value="true"/>
                    </propertyGroup>
                    <sequence key="seq_languageDesc"/>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
        </then>
        <else/>
    </filter>
    <filter regex="DELETE" source="$ctx:method" xmlns:ns="http://org.apache.synapse/xsd">
        <then>
            <payloadFactory media-type="xml">
                <format>
                    <dat:getTableDesc xmlns:dat="http://ws.wso2.org/dataservice">
                        <dat:IdTableDesc>$1</dat:IdTableDesc>
                    </dat:getTableDesc>
                </format>
                <args>
                    <arg evaluator="xml" expression="$ctx:idTableDesc"/>
                </args>
            </payloadFactory>
            <call blocking="true">
                <endpoint>
                    <http method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                        <suspendOnFailure>
                            <initialDuration>-1</initialDuration>
                            <progressionFactor>1</progressionFactor>
                        </suspendOnFailure>
                        <markForSuspension>
                            <retriesBeforeSuspension>0</retriesBeforeSuspension>
                        </markForSuspension>
                    </http>
                </endpoint>
            </call>
            <filter regex="true" source="//*[local-name() = 'IdTableDesc'] >= 1">
                <then>
                    <enrich>
                        <source clone="true" type="body"/>
                        <target property="outputGetTableDesc" type="property"/>
                    </enrich>
                    <property expression="$ctx:outputGetTableDesc//*[local-name() = 'IdLanguageDesc']" name="validIdLanguageDesc" scope="default" type="INTEGER"/>
                </then>
                <else>
                    <propertyGroup>
                        <property name="validResultCode" scope="default" type="STRING" value="SustIMS0151"/>
                        <property name="validMessage" scope="default" type="STRING" value="OK"/>
                        <property name="validStatus" scope="default" type="STRING" value="202"/>
                    </propertyGroup>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
            <payloadFactory media-type="xml">
                <format>
                    <dat:deleteTableDesc xmlns:dat="http://ws.wso2.org/dataservice">
                        <dat:Operation>$1</dat:Operation>
                        <dat:IdTableDesc>$2</dat:IdTableDesc>
                    </dat:deleteTableDesc>
                </format>
                <args>
                    <arg value="DELETE"/>
                    <arg evaluator="xml" expression="$ctx:idTableDesc"/>
                </args>
            </payloadFactory>
            <call blocking="true">
                <endpoint>
                    <http method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                        <suspendOnFailure>
                            <initialDuration>-1</initialDuration>
                            <progressionFactor>1</progressionFactor>
                        </suspendOnFailure>
                        <markForSuspension>
                            <retriesBeforeSuspension>0</retriesBeforeSuspension>
                        </markForSuspension>
                    </http>
                </endpoint>
            </call>
            <filter regex="true" source="//*[local-name() = 'result'] = 1">
                <then/>
                <else>
                    <propertyGroup>
                        <property expression="//*[local-name() = 'resutCode']" name="validResultCode" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'message']" name="validMessage" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'status']" name="validStatus" scope="default" type="STRING"/>
                    </propertyGroup>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
            <sequence key="seq_languageDesc"/>
            <filter regex="true" source="//*[local-name() = 'result'] >= 1">
                <then/>
                <else>
                    <payloadFactory media-type="xml">
                        <format>
                            <dat:postTableDesc xmlns:dat="http://ws.wso2.org/dataservice">
                                <dat:Operation>$1</dat:Operation>
                                <dat:IdLanguageDesc>$2</dat:IdLanguageDesc>
                                <dat:IdLanguage>$3</dat:IdLanguage>
                                <dat:OperationUser>$4</dat:OperationUser>
                                <dat:Active>$5</dat:Active>
                            </dat:postTableDesc>
                        </format>
                        <args>
                            <arg value="INSERT"/>
                            <arg evaluator="xml" expression="$ctx:outputGetTableDesc//*[local-name() = 'IdLanguageDesc']"/>
                            <arg evaluator="xml" expression="$ctx:outputGetTableDesc//*[local-name() = 'IdLanguage']"/>
                            <arg evaluator="xml" expression="$ctx:outputGetTableDesc//*[local-name() = 'TableDescLastUpdatedUser']"/>
                            <arg evaluator="xml" expression="$ctx:outputGetTableDesc//*[local-name() = 'TableDescActive']"/>
                        </args>
                    </payloadFactory>
                    <call blocking="true">
                        <endpoint>
                            <http format="soap12" method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                                <suspendOnFailure>
                                    <initialDuration>-1</initialDuration>
                                    <progressionFactor>1</progressionFactor>
                                </suspendOnFailure>
                                <markForSuspension>
                                    <retriesBeforeSuspension>0</retriesBeforeSuspension>
                                </markForSuspension>
                            </http>
                        </endpoint>
                    </call>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
        </then>
        <else/>
    </filter>
    <filter regex="PUT" source="$ctx:method" xmlns:ns="http://org.apache.synapse/xsd">
        <then>
            <xslt key="trans_putTableDescIn"/>
            <enrich>
                <source clone="true" type="body"/>
                <target property="inputTableDesc" type="property"/>
            </enrich>
            <payloadFactory media-type="xml">
                <format>
                    <dat:getTableDesc xmlns:dat="http://ws.wso2.org/dataservice">
                        <dat:IdTableDesc>$1</dat:IdTableDesc>
                    </dat:getTableDesc>
                </format>
                <args>
                    <arg evaluator="xml" expression="$ctx:idTableDesc"/>
                </args>
            </payloadFactory>
            <call blocking="true">
                <endpoint>
                    <http method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                        <suspendOnFailure>
                            <initialDuration>-1</initialDuration>
                            <progressionFactor>1</progressionFactor>
                        </suspendOnFailure>
                        <markForSuspension>
                            <retriesBeforeSuspension>0</retriesBeforeSuspension>
                        </markForSuspension>
                    </http>
                </endpoint>
            </call>
            <filter regex="true" source="string-length(//*[local-name() = 'IdTableDesc']) > 0">
                <then>
                    <enrich>
                        <source clone="true" type="body"/>
                        <target property="outputGetTableDesc" type="property"/>
                    </enrich>
                    <propertyGroup>
                        <property expression="//*[local-name() = 'IdLanguageDesc']" name="idLanguageDesc" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'IdLanguage']" name="idLanguage" scope="default" type="STRING"/>
                    </propertyGroup>
                </then>
                <else>
                    <propertyGroup description="error">
                        <property name="validResultCode" scope="default" type="STRING" value="SustIMS0151"/>
                        <property name="validMessage" scope="default" type="STRING" value="OK"/>
                        <property name="validStatus" scope="default" type="STRING" value="202"/>
                    </propertyGroup>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
            <payloadFactory media-type="xml">
                <format>
                    <returns>
                        <resultInput>$1</resultInput>
                        <resultDB>$2</resultDB>
                    </returns>
                </format>
                <args>
                    <arg evaluator="xml" expression="$ctx:inputTableDesc"/>
                    <arg evaluator="xml" expression="$ctx:outputGetTableDesc"/>
                </args>
            </payloadFactory>
            <xslt key="trans_putTableDescDBIn">
                <property expression="$ctx:idTableDesc" name="IdTableDesc"/>
                <property expression="$ctx:idLanguageDesc" name="IdLanguageDesc"/>
                <property expression="$ctx:idLanguage" name="IdLanguage"/>
            </xslt>
            <call blocking="true">
                <endpoint>
                    <http format="soap12" method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                        <suspendOnFailure>
                            <initialDuration>-1</initialDuration>
                            <progressionFactor>1</progressionFactor>
                        </suspendOnFailure>
                        <markForSuspension>
                            <retriesBeforeSuspension>0</retriesBeforeSuspension>
                        </markForSuspension>
                    </http>
                </endpoint>
            </call>
            <filter regex="true" source="//*[local-name() = 'result'] = 1">
                <then/>
                <else>
                    <propertyGroup description="error">
                        <property expression="//*[local-name() = 'resutCode']" name="validResultCode" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'message']" name="validMessage" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'status']" name="validStatus" scope="default" type="STRING"/>
                    </propertyGroup>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
            <payloadFactory media-type="xml">
                <format>
                    <result>$1</result>
                </format>
                <args>
                    <arg evaluator="xml" expression="$ctx:inputTableDesc"/>
                </args>
            </payloadFactory>
            <sequence key="seq_languageDesc"/>
            <filter regex="true" source="//*[local-name() = 'result'] = 1">
                <then/>
                <else>
                    <propertyGroup>
                        <property expression="//*[local-name() = 'resultCode']" name="validResultCode" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'message']" name="validMessage" scope="default" type="STRING"/>
                        <property expression="//*[local-name() = 'status']" name="validStatus" scope="default" type="STRING"/>
                    </propertyGroup>
                    <sequence key="seq_messageOutput"/>
                    <payloadFactory media-type="xml">
                        <format>
                            <result>$1</result>
                        </format>
                        <args>
                            <arg evaluator="xml" expression="$ctx:outputGetTableDesc"/>
                        </args>
                    </payloadFactory>
                    <xslt key="trans_putRollbackTableDescDBIn"/>
                    <call blocking="true">
                        <endpoint>
                            <http format="soap12" method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                                <suspendOnFailure>
                                    <initialDuration>-1</initialDuration>
                                    <progressionFactor>1</progressionFactor>
                                </suspendOnFailure>
                                <markForSuspension>
                                    <retriesBeforeSuspension>0</retriesBeforeSuspension>
                                </markForSuspension>
                            </http>
                        </endpoint>
                    </call>
                    <property name="validResultCode" scope="default" type="STRING" value="SustIMS0012"/>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
        </then>
        <else/>
    </filter>
    <filter xmlns:ns="http://org.apache.synapse/xsd" xpath="$ctx:getRollbackLanguageDesc = 'true'">
        <then>
            <property expression="$ctx:idTableDesc" name="idTableDesc" scope="default" type="STRING"/>
            <payloadFactory media-type="xml">
                <format>
                    <dat:getTableDesc xmlns:dat="http://ws.wso2.org/dataservice">
                        <dat:IdTableDesc>$1</dat:IdTableDesc>
                    </dat:getTableDesc>
                </format>
                <args>
                    <arg evaluator="xml" expression="$ctx:idTableDesc"/>
                </args>
            </payloadFactory>
            <call blocking="true">
                <endpoint>
                    <http method="post" uri-template="http://localhost:8290/services/ds_ADMTableDesc">
                        <suspendOnFailure>
                            <initialDuration>-1</initialDuration>
                            <progressionFactor>1</progressionFactor>
                        </suspendOnFailure>
                        <markForSuspension>
                            <retriesBeforeSuspension>0</retriesBeforeSuspension>
                        </markForSuspension>
                    </http>
                </endpoint>
            </call>
            <filter regex="true" source="//*[local-name() = 'IdTableDesc'] >= 1">
                <then>
                    <enrich>
                        <source clone="true" type="body"/>
                        <target property="outputGetTableDesc" type="property"/>
                    </enrich>
                    <property name="validResultCode" scope="default" type="STRING" value="SustIMS0000"/>
                    <sequence key="seq_messageOutput"/>
                    <payloadFactory media-type="xml">
                        <format>
                            <result>$1</result>
                        </format>
                        <args>
                            <arg evaluator="xml" expression="$ctx:outputGetTableDesc"/>
                        </args>
                    </payloadFactory>
                    <xslt key="trans_putGetRollbackTableDescOut">
                        <property expression="$ctx:validMessageDescription" name="messageDescription"/>
                        <property expression="$ctx:validClientMessageDescription" name="clientMessageDescription"/>
                        <property expression="$ctx:validResultCode" name="resultCode"/>
                        <property expression="substring(get-property(&quot;SYSTEM_DATE&quot;,&quot;yyyyy-MM-dd'T'HH:mm:ss.SSS'+'00:00&quot;),2)" name="currentDate"/>
                    </xslt>
                    <enrich>
                        <source clone="true" type="body"/>
                        <target property="getRollbackTableDesc" type="property"/>
                    </enrich>
                </then>
                <else>
                    <propertyGroup>
                        <property name="validResultCode" scope="default" type="STRING" value="SustIMS0002"/>
                        <property name="validMessage" scope="default" type="STRING" value="OK"/>
                        <property name="validStatus" scope="default" type="STRING" value="202"/>
                    </propertyGroup>
                    <sequence key="seq_messageOutput"/>
                    <sequence key="seq_resultOutput"/>
                </else>
            </filter>
        </then>
        <else/>
    </filter>
</sequence>
